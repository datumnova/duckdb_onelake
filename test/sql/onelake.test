# name: test/sql/onelake.test
# description: test onelake extension
# group: [sql]

require onelake

statement ok
INSTALL azure;

statement ok
LOAD azure;

#set azure_transport_option_type = 'curl'



statement ok
CREATE SECRET  (
    TYPE azure,
    PROVIDER service_principal,
    TENANT_ID 'AZURE_TENANT_ID',
    CLIENT_ID 'AZURE_CLIENT_ID',
    CLIENT_SECRET 'AZURE_CLIENT_SECRET'
);

statement ok
CREATE SECRET onelake (
    TYPE ONELAKE,
    TENANT_ID 'AZURE_TENANT_ID',
    CLIENT_ID 'AZURE_CLIENT_ID',
    CLIENT_SECRET 'AZURE_CLIENT_SECRET'
);

#statement ok
#SET onelake_env_token_variable='CUSTOM_STORAGE_TOKEN';

#statement ok
#SET VARIABLE AZURE_STORAGE_TOKEN='unit-test-storage-token';

#statement ok
#CREATE SECRET onelake_env_chain (
#    TYPE ONELAKE,
#    PROVIDER credential_chain,
#    CHAIN 'cli, env'
#);

#statement ok
#CREATE SECRET onelake_env_only (
#    TYPE ONELAKE,
#    PROVIDER credential_chain,
#    CHAIN 'env'
#);

query I
SELECT type || '|' || provider FROM duckdb_secrets() WHERE name='env_secret';
----
azure|access_token

statement ok
ATTACH 'your_workspace_name/your_lakehouse_name.Lakehouse'
      AS your_connection_name
      (TYPE ONELAKE);

#statement ok
#USE your_connection_name;

#statement ok
#SELECT * FROM your_table_name LIMIT 10;

#statement ok
#SELECT * FROM second_lakehouse.your_table_name LIMIT 10;

